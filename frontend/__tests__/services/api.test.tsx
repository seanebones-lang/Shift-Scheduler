import { describe, it, expect, vi, beforeEach, jest } from '@jest/globals';\nimport axios from 'axios';\n\nimport { forecastSales, optimizeShifts, healthCheck } from '../../src/services/api';\n\ntype AxiosStatic = typeof axios;\n\njest.mock('axios');\n\nconst mockedAxios = axios as jest.Mocked<AxiosStatic>;\n\ndescribe('API Services', () => {\n  const mockForecastResponse = {\n    data: { intervals: [{ time: '2024-01-01T00:00:00', demand: 10, confidence_low: 8, confidence_high: 12 }] }\n  };\n  const mockScheduleResponse = {\n    data: { shifts: [], total_cost: 1000 }\n  };\n  const mockHealthResponse = {\n    data: { status: 'healthy', timestamp: '2024-01-01T12:00:00' }\n  };\n  \n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n  \n  describe('forecastSales', () => {\n    it('calls POST /forecast-json with history body', async () => {\n      mockedAxios.post.mockResolvedValue(mockForecastResponse);\n      \n      const history = [\n        { ds: '2024-01-01', y: 100 },\n        { ds: '2024-01-02', y: 110 }\n      ];\n      \n      const result = await forecastSales(history);\n      \n      expect(mockedAxios.post).toHaveBeenCalledWith(\n        '/forecast-json',\n        { history },\n        expect.objectContaining({ headers: { 'Content-Type': 'application/json' }, timeout: 30000 })\n      );\n      expect(result).toEqual(mockForecastResponse.data);\n    });\n    \n    it('throws on error', async () => {\n      mockedAxios.post.mockRejectedValue(new Error('Network error'));\n      \n      await expect(forecastSales([])).rejects.toThrow('Network error');\n    });\n  });\n  \n  describe('optimizeShifts', () => {\n    it('calls POST /optimize-json with req body', async () => {\n      mockedAxios.post.mockResolvedValue(mockScheduleResponse);\n      \n      const req = {\n        forecast: [{ time: '2024-01-01T00:00:00', demand: 5, confidence_low: 4, confidence_high: 6 }],\n        staff: [{ id: '1', name: 'John', wage: 25, skill: 'barista' }]\n      };\n      \n      const result = await optimizeShifts(req);\n      \n      expect(mockedAxios.post).toHaveBeenCalledWith(\n        '/optimize-json',\n        req,\n        expect.objectContaining({ headers: { 'Content-Type': 'application/json' }, timeout: 30000 })\n      );\n      expect(result).toEqual(mockScheduleResponse.data);\n    });\n  });\n  \n  describe('healthCheck', () => {\n    it('calls GET /health', async () => {\n      mockedAxios.get.mockResolvedValue(mockHealthResponse);\n      \n      const result = await healthCheck();\n      \n      expect(mockedAxios.get).toHaveBeenCalledWith('/health', expect.objectContaining({ timeout: 30000 }));\n      expect(result).toEqual(mockHealthResponse.data);\n    });\n  });\n});